DROP SCHEMA IF EXISTS util CASCADE;
CREATE SCHEMA util;

-- distance(lat1, lon1, lat2, lon2) - distance in meters
CREATE OR REPLACE FUNCTION util.distance(DOUBLE PRECISION, DOUBLE PRECISION, DOUBLE PRECISION, DOUBLE PRECISION) 
RETURNS DOUBLE PRECISION
--AS 'SELECT (ACOS(SIN(RADIANS($1+ 0.0000001))*SIN(RADIANS($3 + 0.0000001)) + COS(RADIANS($1+ 0.0000001))*COS(RADIANS($3 + 0.0000001)) * COS(RADIANS($4 + 0.0000001) - RADIANS($2 + 0.0000001)))*6371000);'
AS 'SELECT 6371000.0 * SQRT(POWER((RADIANS($2) - RADIANS($4))*COS((RADIANS($1)+RADIANS($3))/2.0), 2) + POWER((RADIANS($1) - RADIANS($3)), 2));'
LANGUAGE SQL
IMMUTABLE
RETURNS NULL ON NULL INPUT;
